---
title: "MA615 Hurricane Project"
author: "Fan Feng"
date: 2020/11/12
output: 
  revealjs::revealjs_presentation:
  theme: seriftransition: slide
  self_contained: false
  reveal_plugins: ["menu"]
  center: false
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(comment = "#>",
                      collapse = TRUE,
                      cache = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      dpi = 300,
                      cache.lazy = FALSE,
                      tidy = "styler",
                      out.width = "90%",
                      fig.align = "center",
                      fig.width = 10,
                      fig.height = 4)
pacman::p_load(usmap, dplyr, tidyverse, drat, hurricaneexposuredata, ggplot2, maps, tmap, leaflet, sf, sp, lubridate, readr, kableExtra, magrittr, gridExtra, knitr,revealjs,knitr,png,grid)
options(crayon.enabled = FALSE)
theme_set(theme_light())
```

# Introduction

The purpose of this assignment is to show that we know the basics of using R to produce documents, presentations, and shiny apps. These are basic skills that every data scientists must have. 

In this assignment, we use the mapping project you have just completed as a starting point. In addition, we have more county level data from FEMA and FEC so that we can produce maps with relevant features.

# Data Description

The Public Assistance Funded Projects Details dataset contains obligated (financial obligation to grantee) Public Assistance projects, lists public assistance recipients designated as applicants in the data, and a list of every funded, individual project, called project worksheets. Open projects still under pre-obligation processing are not represented.

FEMA provides supplemental Federal disaster grant assistance for debris removal, emergency protective measures, and the repair, replacement, or restoration of disaster-damaged, publicly owned facilities and the facilities of certain Private Non-Profit (PNP) organizations through the PA Program (CDFA Number 97.036). The PA Program also encourages protection of these damaged facilities from future events by providing assistance for hazard mitigation measures during the recovery process.

## Data Cleaning

-We download raw data [PublicAssistanceFundedProjectsDetails.csv]( https://www.fema.gov/openfema-data-page/public-assistance-funded-projects-details-v1) from the website of FEMA and load into R. 

- Filter the data from 2009 ~ 2018
- Add the Names all the hurricanes
- Remove the redundant columns 

# Exploratory Data Analysis

- Temporal Aspect
- Spatial Aspect
- Hurricane Aspect
- Project Size Aspect
- Damage Category Aspect

## Temporal Aspect

<div style="font-size:10pt; font-weight: bold">
```{r, echo = FALSE}

grid.arrange(p1,p2,nrow=1)
```
</div>

## Total Project Amount for Each Year

<div style="font-size:10pt; font-weight: bold">
```{r, echo = FALSE}

grid.arrange(p1,p2,p3,nrow=1)
```
<div>

## Total Project Amount for Different Project Size

<div style="font-size:10pt; font-weight: bold">
```{r, echo = FALSE}

grid.arrange(p1,p2,nrow=1)
```
<div>

## Total Project Amount for Different Damage Categories

<div style="font-size:10pt; font-weight: bold">
```{r, echo = FALSE}

```
<div>

# Mapping The Hurricanes

1. Combine fema_new dataset with map data.

2. Combine Maps Data with data we want to draw.

## Maps of Hurricanes

<div style="font-size:18pt">
<p>We draw the total cost of every state in map.</p>  

```{r echo=FALSE, message=FALSE}
#combine the fips with maps data
##county
data(county.fips)
mapcounty=st_as_sf(map('county',plot=F,fill=T))
colnames(county.fips)[2]=colnames(mapcounty)[1]
mapcounty=left_join(mapcounty,county.fips,'ID')
##state
data(state.fips)
mapstate=st_as_sf(map('state',plot = F,fill = T))
colnames(state.fips)[6]=colnames(mapstate)[1]
mapstate=left_join(mapstate,state.fips,'ID')
mapstate[20,2:6]<-c(25,22,1,1,"MA")
mapstate[21,2:6]<-c(26,23,2,3,"MI")
mapstate[31,2:6]<-c(36,33,1,2,"NY")
mapstate[32,2:6]<-c(37,34,3,5,"NC")
mapstate[45,2:6]<-c(51,49,3,5,"VA")
mapstate[46,2:6]<-c(53,50,4,9,"WA")
colnames(mapstate)[2] <- "stateNumberCode"
mapstate$stateNumberCode<- as.numeric(mapstate$stateNumberCode)
#combine data
#by state
hurricane_group<- group_by(PAFPD_0918, stateNumberCode)
h_GroupByfips<- summarise(hurricane_group,sumcost = sum(projectAmount),.groups='drop')
h_GroupByfips<- h_GroupByfips[order(h_GroupByfips$sumcost,decreasing=F),]
hcount_s <- right_join(mapstate,h_GroupByfips,"stateNumberCode")
#by county
hurricane_group <- filter(PAFPD_0918,countyCode!=0)
hurricane_group<- group_by(hurricane_group, fips)
h_GroupByfips<- summarise(hurricane_group,sumcost = sum(projectAmount),.groups='drop')
h_GroupByfips<- h_GroupByfips[order(h_GroupByfips$sumcost,decreasing=F),]
hcount_c <- right_join(mapcounty,h_GroupByfips,"fips")
hcount_c <- filter(hcount_c,is.na(ID)==F)
hcount_c2 <- filter(hcount_c,sumcost<200000000)
hcount_c3 <- filter(hcount_c,sumcost>200000000)
```


```{r, echo = FALSE}
#leaflet
#state
img = readPNG("stateplot.png")
grid.raster(img)
```

  
<p>As shown in the picture, hurricanes mainly influence the east coast. New York has the largest estimated total cost in 2009-2018.</p>  

# References

The data is collected from: https://www.fema.gov/openfema-data-page/public-assistance-funded-projects-details-v1

1. Yihui Xie (2020). knitr: A General-Purpose Package for Dynamic Report Generation in R. R package version 1.29. https://github.com/yihui/knitr

2. Hadley Wickham (2019). tidyverse: Easily Install and Load the 'Tidyverse'. R package version 1.3.0. https://cloud.r-project.org/package=tidyverse

3. Greg Freedman Ellis, Thomas Lumley, Tomasz Żółtak and Ben Schneider (2020). srvyr:'dplyr'-Like Syntax for Summary Statistics of SUrvey Data. R package version 0.4.0. https://cloud.r-project.org/package=srvyr


# Thanks

Thanks for Listening!



